# ichw
### 高速缓冲存储器结构
高速缓冲存储器是存在于主存与CPU之间的一级存储器，速度比主存快, 比寄存器慢; 容量比主存小很多, 比寄存器大很多。
其主要为以下三部分组成： 

**Cache存储体**：存放由主存调入的指令与数据块。

**地址转换部件**：建立目录表以实现主存地址到缓存地址的转换。

**替换部件**：在缓存已满时按一定策略进行数据块替换，并修改地址转换部件。

### 高速缓冲存储器工作原理
在主存－Cache存储体系中，所有的指令和数据都存在主存中，Cache只是存放主存中的一部分程序块和数据块的副本，只是一种以块为单位的存储方式。Cache和主存被分为块，每块由多个字节组成。在一个时间段内，Cache的某块中放着主存某块的全部信息。CPU访问存储器时，送出访问单元的地址，由地址总线传送到Cache控制器中的主存地址寄存器MA，主存—Cache地址转换机构从MA获取地址并判断该单元内容是否已在Cache中存有副本，如果副本已存在Cache中，即命中。当命中时，立即把访问地址变换成它在Cache中的地址，而后访问Cache。如果CPU要访问的内容不在Cache中，即不命中，则CPU转去直接访问主存，并将包含此存储单元的整个数据块（包括该块数据的地址信息）传到 Cache中，使得以后的若干次对内存的访问可转化为对Cache的访问。若Cache存储器已满，则需在替换控制部件的控制下，根据某种替换算法/策略，用此块信息替换掉Cache中的原来的某块信息。所以，要想提高系统效率，必须提高Cache命中率，而Cache命中率的提高则取决于Cache的映象方式和Cache刷新算法等因素。

#### 地址映象方式:

直接映象:每个主存地址映像到Cache中的一个指定地址的方式。在直接映象方式下，主存中存储单元的数据只可调入Cache中的一个位置，如果主存中另一个存储单元的数据也要调入该位置则将发生冲突。地址映像的方法一般是将主存空间按Cache的尺寸分区，每区内相同的块号映像到Cache 中相同的块位置。直接映象是一种最简单的地址映像方式，它的地址变换速度快，而且不涉及其他两种映像方式中的替换策略问题。但是这种方式的块冲突概率较高，当称序往返访问两个相互冲突的块中的数据时，Cache的命中率将急剧下降，因为这时即使Cache中有其他空闲块，也因为固定的地址映像关系而无法应用。

全相联映象：主存与缓存分成相同大小的数据块。主存的某一数据块可以装入缓存的任意一块空间中。如果Cache的块数为Cb，主存的块数为Mb，则映象关系共有Cb×Mb种。目录表存放在相关（联）存储器中，其中包括三部分：数据块在主存的块地址、存入缓存后的块地址、及有效位（也称装入位）。由于是全相联方式，因此，目录表的容量应当与缓存的块数相同。命中率比较高，Cache存储空间利用率高。但关存储器时，每次都要与全部内容比较，速度低，成本高，因而应用少。

组相联映象：组相联映象方式是直接映象和全相联映象的一种折衷方案。这种方法将存储空间分为若干组，各组之间是直接映像，而组内各块之间则是全相联映像。组相联方式在判断块命中及替换算法上都要比全相联方式简单，块冲突的概率比直接映像的低，其命中率也介于直接映像和全相联映像方式之间。

#### 替换策略：

先进先出策略（FIFO）：把最先调入的Cache字块替换出去，它不需要随时记录各个字块的使用情况，较容易实现；缺点是经常使用的块，如一个包含循环程序的块也可能由于它是最早的块而被替换掉。  最近最少使用策略（LRU）：把Cache中使用次数最少的那块信息块替换出去，这种替换算法需要随时记录Cache中字块的使用情况。LRU的平均命中率比 FIFO高，在组相联映像方式中，当分组容量加大时，LRU的命中率也会提高。


参考：高速缓冲存储器搜狗百科以及CSDN博客Cache详解
